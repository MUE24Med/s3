<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  background:#0d1117;
  color:#fff;
  font-family:Arial;
  overflow:hidden;
}

#top{
  display:flex;
  justify-content:space-between;
  padding:8px 12px;
  background:#000;
}

#game{
  position:relative;
  height:60vh;
  background:#111;
  overflow:hidden;
}

#player{
  position:absolute;
  bottom:10px;
  font-size:40px;
  left:50%;
  transform:translateX(-50%);
}

.item{
  position:absolute;
  font-size:28px;
}

#controls{
  display:flex;
  justify-content:space-around;
  background:#000;
  padding:10px;
}

button{
  font-size:20px;
  padding:6px 20px;
}

#loader{
  padding:15px;
  text-align:center;
}

#bar{
  height:14px;
  background:#222;
  border-radius:10px;
  overflow:hidden;
  margin:10px 0;
}

#progress{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#00ffcc,#00ccff);
}

#gameOver{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,.9);
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  z-index:10;
  display:none;
}
</style>
</head>

<body>

<div id="top">
  <div>â¤ï¸ <span id="hearts">0</span></div>
  <div>ğŸ“¦ <span id="percent">0%</span></div>
</div>

<div id="game">
  <div id="player">ğŸ‘¨â€âš•ï¸</div>
  <div id="gameOver">
    <h2>Game Over</h2>
    <button onclick="restart()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù„Ø¹Ø¨</button>
  </div>
</div>

<div id="controls">
  <!-- Ù…Ø¹ÙƒÙˆØ³ÙŠÙ† -->
  <button onclick="moveRight()">â¬…ï¸</button>
  <button onclick="moveLeft()">â¡ï¸</button>
</div>

<div id="loader">
  <div id="bar"><div id="progress"></div></div>
  <button id="continue" style="display:none">â–¶ï¸ Ù…ØªØ§Ø¨Ø¹Ø©</button>
</div>

<script>
/* ===== LOADING ===== */
const FILES = [
  "./index.html",
  "./style.css",
  "./script.js",
  "./tracker.js",
  "./image/wood.webp",
  "./image/0.png"
];

let loaded = 0;
const progress = document.getElementById("progress");
const percent = document.getElementById("percent");
const continueBtn = document.getElementById("continue");

FILES.forEach(f=>{
  fetch(f,{cache:"reload"})
    .catch(()=>{})
    .finally(()=>{
      loaded++;
      const p = Math.round((loaded/FILES.length)*100);
      progress.style.width = p+"%";
      percent.textContent = p+"%";
      if(p===100) continueBtn.style.display="inline-block";
    });
});

continueBtn.onclick=()=>{
  localStorage.setItem("preload_done","true");
  location.href="index.html";
};

/* ===== GAME ===== */
const game = document.getElementById("game");
const player = document.getElementById("player");
const heartsEl = document.getElementById("hearts");
const gameOver = document.getElementById("gameOver");

let px = game.clientWidth/2;
let hearts = 0;
let running = true;

function moveLeft(){ px += 30; update(); }
function moveRight(){ px -= 30; update(); }

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowLeft") moveRight();
  if(e.key==="ArrowRight") moveLeft();
});

function update(){
  px=Math.max(0,Math.min(game.clientWidth-40,px));
  player.style.left=px+"px";
}

function spawn(){
  if(!running) return;
  for(let i=0;i<2;i++) drop();
  setTimeout(spawn,1200);
}

function drop(){
  const el=document.createElement("div");
  el.className="item";
  const r=Math.random();
  el.textContent=r<.4?"ğŸ¦ ":r<.7?"â˜£ï¸":"ğŸ’Š";
  el.style.left=Math.random()*(game.clientWidth-30)+"px";
  el.style.top="0px";
  game.appendChild(el);

  let y=0;
  function fall(){
    if(!running){el.remove();return;}
    y+=3;
    el.style.top=y+"px";

    if(y>game.clientHeight/2 && !el.spawned){
      el.spawned=true;
      drop();drop();
    }

    const p=player.getBoundingClientRect();
    const i=el.getBoundingClientRect();
    if(i.bottom>p.top && i.left<p.right && i.right>p.left){
      hit(el.textContent);
      el.remove();return;
    }

    if(y<game.clientHeight) requestAnimationFrame(fall);
    else el.remove();
  }
  fall();
}

function hit(t){
  if(t==="ğŸ’Š") hearts++;
  if(t==="ğŸ¦ ") hearts--;
  if(t==="â˜£ï¸") hearts-=2;
  heartsEl.textContent=hearts;
  if(hearts<0) end();
}

function end(){
  running=false;
  gameOver.style.display="flex";
}

function restart(){
  location.reload();
}

update();
spawn();
</script>

</body>
</html>