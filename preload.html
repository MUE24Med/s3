<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</title>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #fff;
  padding: 10px;
}

.container {
  width: 100%;
  max-width: 450px;
  background: rgba(0, 0, 0, 0.85);
  border-radius: 20px;
  padding: 20px;
  text-align: center;
  box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
}

.notice {
  font-size: 12px;
  background: rgba(46, 204, 113, 0.15);
  color: #2ecc71;
  padding: 10px;
  border-radius: 10px;
  margin-bottom: 15px;
  border: 1px solid rgba(46, 204, 113, 0.3);
}

.logo {
  font-size: 50px;
  margin-bottom: 10px;
  animation: bounce 2s infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

h1 {
  font-size: 24px;
  margin: 10px 0;
  color: #3498db;
}

.subtitle {
  font-size: 14px;
  opacity: 0.8;
  margin-bottom: 15px;
}

.progress-container {
  background: #222;
  border-radius: 10px;
  overflow: hidden;
  height: 25px;
  margin: 15px 0;
  position: relative;
}

.progress-bar {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #3498db, #2ecc71);
  transition: width 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 13px;
}

.file-status {
  font-size: 13px;
  background: rgba(255, 255, 255, 0.1);
  padding: 8px;
  border-radius: 8px;
  margin: 10px 0;
  min-height: 35px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.continue-btn {
  display: none;
  margin: 15px 0;
  padding: 12px 30px;
  width: 100%;
  border: none;
  border-radius: 25px;
  background: linear-gradient(135deg, #2ecc71, #27ae60);
  color: white;
  font-weight: bold;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3);
}

.continue-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 7px 20px rgba(46, 204, 113, 0.5);
}

.game-container {
  background: linear-gradient(180deg, #1a1a2e, #0f0f1e);
  height: 500px; /* ØªÙ… ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
  border-radius: 15px;
  position: relative;
  overflow: hidden;
  margin: 15px 0;
  border: 2px solid rgba(52, 152, 219, 0.3);
}

.game-stats {
  position: absolute;
  top: 10px;
  left: 10px;
  right: 10px;
  display: flex;
  justify-content: space-between;
  z-index: 10;
  pointer-events: none;
}

.game-stat {
  background: rgba(0, 0, 0, 0.7);
  padding: 8px 15px;
  border-radius: 10px;
  font-size: 18px;
  font-weight: bold;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.runner {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 35px;
  z-index: 5;
}

.falling-item {
  position: absolute;
  top: -40px;
  font-size: 30px;
  z-index: 1;
  transition: left 0.2s ease;
}

.game-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.95);
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  z-index: 10;
  backdrop-filter: blur(5px);
}

.game-overlay h2 {
  font-size: 28px;
  margin-bottom: 10px;
  color: #e74c3c;
}

.final-score {
  font-size: 20px;
  margin: 10px 0;
  color: #3498db;
}

.restart-btn {
  font-size: 40px;
  background: none;
  border: none;
  color: #2ecc71;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.controls {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}

.control-btn {
  flex: 1;
  padding: 15px;
  border: none;
  border-radius: 15px;
  background: linear-gradient(135deg, #3498db, #2980b9);
  color: white;
  font-weight: bold;
  font-size: 20px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
}

.leaderboard {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  padding: 10px;
  margin-top: 15px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

@media (max-width: 480px) {
  .container {
    padding: 15px;
  }
  .game-container {
    height: 500px; /* Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ø­ØªÙ‰ ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„ */
  }
}
</style>
</head>

<body>

<div class="container">
  <div class="notice">
    ğŸ’¡ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ØªØ¸Ù‡Ø± ÙÙŠ Ø£ÙˆÙ„ Ø²ÙŠØ§Ø±Ø© ÙÙ‚Ø· â€” Ø§Ù„Ù…Ù„ÙØ§Øª Ø³ØªÙØ®Ø²Ù† ÙÙŠ Ø§Ù„ÙƒØ§Ø´ Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ø§Ø­Ù‚Ø§Ù‹
  </div>

  <div class="logo">ğŸ¥</div>
  <h1>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„</h1>
  <div class="subtitle">ØªØ¬Ù†Ø¨ Ø§Ù„Ø¹Ø¯ÙˆÙ‰ ğŸ¦  ÙˆØ§Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù„Ø§Ø¬ ğŸ’Š</div>

  <div class="progress-container">
    <div class="progress-bar" id="progressBar">0%</div>
  </div>

  <div class="file-status" id="fileStatus">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø¯Ø¡...</div>

  <button class="continue-btn" id="continueBtn">Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ â¡ï¸</button>

  <div class="game-container" id="gameContainer">
    <div class="game-stats">
      <div class="game-stat">â¤ï¸ <span id="heartsDisplay">0</span></div>
      <div class="game-stat">â­ <span id="scoreDisplay">0</span></div>
    </div>

    <div class="runner" id="runner">ğŸ‘¨â€âš•ï¸</div>

    <div class="game-overlay" id="gameOverlay">
      <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©!</h2>
      <div class="final-score" id="finalScore">Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
      <button class="restart-btn" id="restartBtn">ğŸ”„</button>
    </div>
  </div>

  <div class="controls">
    <button class="control-btn" id="leftBtn">â¡ï¸</button>
    <button class="control-btn" id="rightBtn">â¬…ï¸</button>
  </div>

  <div class="leaderboard">
    <h3>ğŸ† Ø£ÙØ¶Ù„ 5 Ù„Ø§Ø¹Ø¨ÙŠÙ†</h3>
    <ul class="leaderboard-list" id="leaderboardList">
      <li class="leaderboard-item">
        <span class="leaderboard-rank">-</span>
        <span class="leaderboard-name">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
        <span class="leaderboard-score">-</span>
      </li>
    </ul>
  </div>
</div>

<script>
// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª
const filesToLoad = [
  'image/wood.webp', 'image/Upper_wood.webp', 'image/logo-A.webp',
  'image/logo-B.webp', 'image/logo-C.webp', 'image/logo-D.webp',
  'image/0.png', 'style.css', 'script.js', 'tracker.js'
];

const progressBar = document.getElementById('progressBar');
const fileStatus = document.getElementById('fileStatus');
const continueBtn = document.getElementById('continueBtn');

let loadedFiles = 0;
const totalFiles = filesToLoad.length;

function updateProgress() {
  const percentage = Math.round((loadedFiles / totalFiles) * 100);
  progressBar.style.width = percentage + '%';
  progressBar.textContent = percentage + '%';
}

async function loadFile(url) {
  try {
    const cache = await caches.open('semester-3-cache-v1');
    let cachedResponse = await cache.match(url);

    if (!cachedResponse) {
      const response = await fetch(url);
      if (response.ok) {
        await cache.put(url, response.clone());
      }
    }
    
    loadedFiles++;
    updateProgress();
    fileStatus.textContent = `âœ” ØªÙ…: ${url.split('/').pop()}`;
  } catch (error) {
    console.error('Error loading:', url);
    loadedFiles++;
    updateProgress();
  }
}

async function startLoading() {
  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¨Ø§Ù„ØªÙˆØ§Ø²ÙŠ ÙˆØ¨Ø¯ÙˆÙ† Ø£ÙŠ setTimeout
  await Promise.all(filesToLoad.map(file => loadFile(file)));
  
  fileStatus.textContent = 'ğŸ‰ Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„!';
  continueBtn.style.display = 'block';
}

startLoading();

continueBtn.addEventListener('click', () => {
  localStorage.setItem('preload_done', 'true');
  localStorage.setItem('last_visit_timestamp', Date.now());
  window.location.replace('index.html');
});

// ====================
// Ù†Ø¸Ø§Ù… Ø§Ù„Ù„Ø¹Ø¨Ø© (Ù…Ø­Ø¯Ø«)
// ====================

const gameContainer = document.getElementById('gameContainer');
const runner = document.getElementById('runner');
const heartsDisplay = document.getElementById('heartsDisplay');
const scoreDisplay = document.getElementById('scoreDisplay');
const gameOverlay = document.getElementById('gameOverlay');
const finalScore = document.getElementById('finalScore');
const restartBtn = document.getElementById('restartBtn');
const leftBtn = document.getElementById('leftBtn');
const rightBtn = document.getElementById('rightBtn');
const leaderboardList = document.getElementById('leaderboardList');

let runnerPosition = 0;
let hearts = 0;
let score = 0;
let gameActive = true;
let fallSpeed = 2.0; // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø±Ø¹Ø© Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„ØªÙ†Ø§Ø³Ø¨ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
let activeItems = [];
let waveCounter = 0;
let usedLanesInWave = [];
let spawnInterval = 1800;

const lanes = [20, 50, 80];

function moveRunner(direction) {
  if (!gameActive) return;
  runnerPosition += direction;
  runnerPosition = Math.max(-1, Math.min(1, runnerPosition));
  runner.style.left = lanes[runnerPosition + 1] + '%';
}

leftBtn.addEventListener('click', () => moveRunner(1));
rightBtn.addEventListener('click', () => moveRunner(-1));

document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowLeft' || e.key === 'a') moveRunner(-1);
  if (e.key === 'ArrowRight' || e.key === 'd') moveRunner(1);
});

function spawnWave() {
  if (!gameActive) return;
  const itemsInWave = 2;
  for (let i = 0; i < itemsInWave; i++) {
    spawnItem();
  }
}

function spawnItem() {
  const rand = Math.random();
  let emoji, type;

  if (rand < 0.15) { emoji = 'ğŸ’Š'; type = 'pill'; } 
  else if (rand < 0.60) { emoji = 'ğŸ¦ '; type = 'bacteria'; } 
  else { emoji = 'ğŸ‘¾'; type = 'virus'; }

  let availableLanes = [0, 1, 2].filter(lane => !usedLanesInWave.includes(lane));
  if (availableLanes.length === 0) {
    usedLanesInWave = [];
    availableLanes = [0, 1, 2];
  }

  const laneIndex = availableLanes[Math.floor(Math.random() * availableLanes.length)];
  usedLanesInWave.push(laneIndex);

  const item = document.createElement('div');
  item.className = 'falling-item';
  item.textContent = emoji;
  item.dataset.type = type;
  item.dataset.lane = laneIndex;
  item.style.left = lanes[laneIndex] + '%';
  item.style.top = '-40px';

  gameContainer.appendChild(item);
  activeItems.push({ element: item, y: -40, lane: laneIndex, type: type });
}

function updateGame() {
  if (!gameActive) return;

  const containerHeight = gameContainer.offsetHeight;

  for (let i = activeItems.length - 1; i >= 0; i--) {
    let itemData = activeItems[i];
    itemData.y += fallSpeed;
    itemData.element.style.top = itemData.y + 'px';

    // Ø§Ù„ØªØµØ§Ø¯Ù…
    if (itemData.y > containerHeight - 100 && itemData.y < containerHeight - 40) {
      if (itemData.lane === (runnerPosition + 1)) {
        if (itemData.type === 'pill') hearts++;
        else if (itemData.type === 'bacteria') hearts--;
        else if (itemData.type === 'virus') hearts -= 2;

        heartsDisplay.textContent = hearts;
        itemData.element.remove();
        activeItems.splice(i, 1);
        if (hearts < 0) endGame();
        continue;
      }
    }

    // Ø§Ù„Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ù„ØªØ¬Ù†Ø¨
    if (itemData.y > containerHeight) {
      score++;
      scoreDisplay.textContent = score;
      itemData.element.remove();
      activeItems.splice(i, 1);
    }
  }

  requestAnimationFrame(updateGame);
}

function endGame() {
  gameActive = false;
  finalScore.textContent = `Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${score}`;
  gameOverlay.style.display = 'flex';
  // Ù…Ù†Ø·Ù‚ Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù‡Ù†Ø§
}

function restartGame() {
  activeItems.forEach(item => item.element.remove());
  activeItems = [];
  hearts = 0; score = 0; runnerPosition = 0; fallSpeed = 2.0;
  heartsDisplay.textContent = hearts;
  scoreDisplay.textContent = score;
  runner.style.left = lanes[1] + '%';
  gameOverlay.style.display = 'none';
  gameActive = true;
  updateGame();
}

restartBtn.addEventListener('click', restartGame);
updateGame();

setInterval(() => {
  if (gameActive) {
    spawnWave();
    if (score > 0 && score % 10 === 0) fallSpeed += 0.1;
  }
}, 1500);

</script>
</body>
</html>
