<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Preload Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  background:#111;
  color:#fff;
  font-family:Arial;
  overflow:hidden;
}

/* UI */
#ui{
  display:flex;
  justify-content:space-between;
  padding:8px 12px;
  background:#000;
  font-size:14px;
}

/* Game */
#game{
  position:relative;
  width:100vw;
  height:calc(100vh - 120px);
  background:#222;
  overflow:hidden;
}

/* Player */
#player{
  position:absolute;
  bottom:8px;
  font-size:42px;
  left:50%;
  transform:translateX(-50%);
}

/* Items */
.item{
  position:absolute;
  font-size:30px;
}

/* Controls (ŸÖÿπŸÉŸàÿ≥ÿ©) */
#controls{
  display:flex;
  justify-content:space-around;
  padding:10px;
  background:#000;
}

button{
  font-size:22px;
  padding:8px 22px;
}

/* Game Over */
#gameOver{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:5;
}

.hidden{display:none}
</style>
</head>

<body>

<div id="ui">
  <div>‚ù§Ô∏è <span id="hearts">0</span></div>
  <div>üèÜ <span id="score">0</span></div>
</div>

<div id="game">
  <div id="player">üë®‚Äç‚öïÔ∏è</div>
</div>

<div id="controls">
  <!-- ŸÖÿπŸÉŸàÿ≥ŸäŸÜ -->
  <button id="btnRight">‚¨ÖÔ∏è</button>
  <button id="btnLeft">‚û°Ô∏è</button>
</div>

<div id="gameOver" class="hidden">
  <h2>Game Over</h2>
  <button id="restart">üîÑ ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÑÿπÿ®</button>
</div>

<script>
/* ================= GAME ================= */

const game = document.getElementById("game");
const player = document.getElementById("player");
const heartsEl = document.getElementById("hearts");
const scoreEl = document.getElementById("score");
const gameOverBox = document.getElementById("gameOver");

let gameWidth = game.clientWidth;
let playerX = gameWidth / 2;
let hearts = 0;
let score = 0;
let speed = 2;
let running = true;

/* Player */
function updatePlayer(){
  if(playerX < 0) playerX = 0;
  if(playerX > gameWidth - 40) playerX = gameWidth - 40;
  player.style.left = playerX + "px";
}

/* Controls (ŸÖÿπŸÉŸàÿ≥ÿ©) */
function moveLeft(){ playerX += 30; updatePlayer(); }
function moveRight(){ playerX -= 30; updatePlayer(); }

document.getElementById("btnLeft").onclick = moveRight;
document.getElementById("btnRight").onclick = moveLeft;

document.addEventListener("keydown", e=>{
  if(!running) return;
  if(e.key === "ArrowLeft") moveRight();
  if(e.key === "ArrowRight") moveLeft();
});

/* Spawn */
function createItem(){
  if(!running) return;

  const el = document.createElement("div");
  el.className = "item";

  const r = Math.random();
  el.textContent = r < 0.4 ? "ü¶†" : r < 0.7 ? "‚ò£Ô∏è" : "üíä";

  el.style.left = Math.random() * (gameWidth - 30) + "px";
  el.style.top = "0px";
  game.appendChild(el);

  let y = 0;

  const fall = () => {
    if(!running){ el.remove(); return; }

    y += speed;
    el.style.top = y + "px";

    const p = player.getBoundingClientRect();
    const i = el.getBoundingClientRect();

    if(i.bottom > p.top && i.left < p.right && i.right > p.left){
      hit(el.textContent);
      el.remove();
      return;
    }

    if(y < game.clientHeight){
      requestAnimationFrame(fall);
    }else{
      el.remove();
      score++;
      scoreEl.textContent = score;
    }
  };

  fall();
}

/* Hit */
function hit(type){
  if(type === "üíä") hearts++;
  if(type === "ü¶†") hearts--;
  if(type === "‚ò£Ô∏è") hearts -= 2;

  heartsEl.textContent = hearts;
  if(hearts < 0) endGame();
}

/* Loop */
function loop(){
  if(!running) return;
  createItem();
  createItem(); // ÿßÿ™ŸÜŸäŸÜ
  speed += 0.1;
  setTimeout(loop, 1300);
}

/* End */
function endGame(){
  running = false;
  gameOverBox.classList.remove("hidden");
}

document.getElementById("restart").onclick = ()=>location.reload();

/* Init */
updatePlayer();
loop();
</script>

</body>
</html>