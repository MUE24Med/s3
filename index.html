<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>semester-3 | ุฎุฑูุทุฉ ุงููููุฉ ุงูุชูุงุนููุฉ</title>

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://mue24med.github.io/semester-3/">
  <meta property="og:title" content="semester-3 | ุฎุฑูุทุฉ ุงููููุฉ ุงูุชูุงุนููุฉ">
  <meta property="og:description" content="ุฎุฑูุทุฉ ุชูุงุนููุฉ ูุนุฑุถ ูุญุงุถุฑุงุช ูุณูุงุดู ุงููุฑูุฉ ุงูุซุงููุฉ - ุงููุตู ุงูุฏุฑุงุณู ุงูุซุงูุซ">
  <meta property="og:image" content="https://mue24med.github.io/semester-3/image/0.webp">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:locale" content="ar_AR">

  <!-- PWA / Mobile -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="theme-color" content="#000000">
  <meta name="color-scheme" content="only light">

  <!-- Cache Control -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="version" content="2025.02.16.FIXED">

  <!-- Performance -->
  <link rel="preconnect" href="https://raw.githubusercontent.com" crossorigin>
  <link rel="preconnect" href="https://api.github.com" crossorigin>
  <link rel="dns-prefetch" href="https://mozilla.github.io">

  <!-- Icons -->
  <link rel="icon" type="image/png" href="image/0.png">
  <link rel="apple-touch-icon" href="image/0.png">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- ================ ุฌููุน ุนูุงุตุฑ ุงููุงุฌูุฉ ================ -->

<!-- ุดุงุดุฉ ุงุฎุชูุงุฑ ุทุฑููุฉ ุงููุชุญ -->
<div id="open-method-popup" class="hidden">
  <div class="method-container">
    <div class="method-header">
      <h2>ุงุฎุชุฑ ุทุฑููุฉ ุงููุชุญ</h2>
      <span class="method-close" id="method-close-btn">โ๏ธ</span>
    </div>
    <div class="method-filename" id="method-filename">ุงุณู ุงูููู</div>
    <div class="method-preview">
      <canvas id="method-preview-canvas"></canvas>
      <div class="method-loading" id="method-loading">โณ ุฌุงุฑู ุงูุชุญููู...</div>
    </div>
    <div class="method-buttons">
      <button class="method-btn mozilla-btn" id="open-mozilla-btn">
        <span class="method-btn-icon">๐</span>
        <span class="method-btn-text">Mozilla PDF</span>
      </button>
      <button class="method-btn browser-btn" id="open-browser-btn">
        <span class="method-btn-icon">๐</span>
        <span class="method-btn-text">ุงููุชุตูุญ</span>
      </button>
      <button class="method-btn drive-btn" id="open-drive-btn">
        <span class="method-btn-icon">๐พ</span>
        <span class="method-btn-text">Google Drive</span>
      </button>
    </div>
  </div>
</div>

<!-- ๐ฎ ุดุงุดุฉ Preload ุงููุญุณูุฉ -->
<div id="preload-screen" class="hidden">
  <div class="preload-container">
    <div class="notice">
      ๐ก ูุฐู ุงูุตูุญุฉ ุชุธูุฑ ูู ุฃูู ุฒูุงุฑุฉ ููุท โ ุงููููุงุช ุณุชูุฎุฒู ูู ุงููุงุด ููุชุญููู ุงูุณุฑูุน ูุงุญูุงู
    </div>
    <div class="logo">๐ฅ</div>
    <h1>ุฌุงุฑู ุงูุชุญููู</h1>
    <div class="subtitle">ุชุฌูุจ ุงูุนุฏูู ๐ฆ ูุงุฌูุน ุงูุนูุงุฌ ๐</div>

    <!-- ุดุฑูุท ุงูุชูุฏู -->
    <div class="progress-container">
      <div class="progress-bar" id="progressBar">0%</div>
    </div>
    <div class="file-status" id="fileStatus">ุฌุงุฑู ุงูุจุฏุก...</div>
    <button class="continue-btn" id="continueBtn">ูุชุงุจุนุฉ ุฅูู ุงููููุน โก๏ธ</button>

    <!-- ๐ฎ ุญุงููุฉ ุงููุนุจุฉ ุงููุญุณูุฉ -->
    <div class="game-container" id="gameContainer">
      <!-- ุฅุญุตุงุฆูุงุช ุงููุนุจุฉ -->
      <div class="game-stats">
        <div class="game-stat">โค๏ธ <span id="heartsDisplay">0</span></div>
        <div class="game-stat">โญ <span id="scoreDisplay">0</span></div>
      </div>

      <!-- ๐ ุนุฑุถ ุงูุฑูู ุงูููุงุณู ุงูุดุฎุตู -->
      <div id="personalRecordDisplay" title="ุฑููู ุงูููุงุณู">
        ๐ <span id="personalRecordValue">0</span>
      </div>

      <!-- ุงููุงุนุจ -->
      <div class="runner" id="runner">๐จโโ๏ธ</div>

      <!-- ุดุงุดุฉ ุงูููุงูุฉ -->
      <div class="game-overlay" id="gameOverlay">
        <h2>๐ฎ ุงูุชูุช ุงููุนุจุฉ!</h2>
        <div class="final-score" id="finalScore">ุงูููุงุท: 0</div>

        <!-- ๐ ุฑุณุงูุฉ ุงูุฑูู ุงูููุงุณู -->
        <div id="recordMessage"></div>

        <button class="restart-btn" id="restartBtn" title="ุฅุนุงุฏุฉ ุงููุนุจ">๐</button>

        <!-- ๐ ูุงุฆูุฉ ุฃูุถู 5 ูุงุนุจูู -->
        <div class="leaderboard">
          <h3>๐ ุฃูุถู 5 ูุงุนุจูู ุนุงูููุงู</h3>
          <ul class="leaderboard-list" id="leaderboardList">
            <li class="leaderboard-item">
              <span class="leaderboard-rank">-</span>
              <span class="leaderboard-name">ุฌุงุฑู ุงูุชุญููู...</span>
              <span class="leaderboard-score">-</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- ุฃุฒุฑุงุฑ ุงูุชุญูู -->
    <div class="controls">
      <button class="control-btn" id="leftBtn">โก๏ธ</button>
      <button class="control-btn" id="rightBtn">โฌ๏ธ</button>
    </div>
  </div>
</div>

<!-- ๐ ููุฎุต ุงูุฌูุณุฉ (ูุธูุฑ ูู ุฃุณูู ุงููุณุงุฑ) -->
<div id="sessionSummary">
  <h4>๐ ููุฎุต ุงูุฌูุณุฉ</h4>
  <div class="stat">
    <span class="stat-label">ุนุฏุฏ ุงูุฃูุนุงุจ:</span>
    <span class="stat-value" id="sessionGamesCount">0</span>
  </div>
  <div class="stat">
    <span class="stat-label">ุฅุฌูุงูู ุงูููุงุท:</span>
    <span class="stat-value" id="sessionTotalScore">0</span>
  </div>
  <div class="stat">
    <span class="stat-label">ุฃุนูู ููุงุท:</span>
    <span class="stat-value" id="sessionHighScore">0</span>
  </div>
  <div class="stat">
    <span class="stat-label">ุงููุชูุณุท:</span>
    <span class="stat-value" id="sessionAvgScore">0</span>
  </div>
</div>

<!-- ุดุงุดุฉ ุงุฎุชูุงุฑ ุงููุฌููุนุฉ -->
<div id="group-selection-screen">
  <div id="group-selection-content">
    <img id="main-logo" src="image/0.png" alt="ุดุนุงุฑ ุงููููุฉ" />
    <h1>ุงุฎุชุฑ ูุฌููุนุชู</h1>
    <div id="group-buttons">
      <button class="group-btn" data-group="A"><span class="group-letter">A</span><span class="group-label">Group A</span></button>
      <button class="group-btn" data-group="B"><span class="group-letter">B</span><span class="group-label">Group B</span></button>
      <button class="group-btn" data-group="C"><span class="group-letter">C</span><span class="group-label">Group C</span></button>
      <button class="group-btn" data-group="D"><span class="group-letter">D</span><span class="group-label">Group D</span></button>
    </div>
    <p style="color: #888; font-size: 12px; margin-top: 20px;">
      ๐ก ููููู ุชุบููุฑ ุงููุฌููุนุฉ ูุงุญูุงู ูู ุฒุฑ "๐ Change Group"
    </p>
  </div>
</div>

<!-- ุดุฑูุท ุงูุฃุฏูุงุช -->
<div id="js-toggle-container" class="top">
  <div id="search-container">
    <input type="text" id="search-input" placeholder="ุงุจุญุซ ุจุงุณู ุงูููู..." autocomplete="off">
    <span id="search-icon" class="clickable-area">๐</span>
  </div>
  <div class="controls-row">
    <span id="move-toggle">โ๏ธ</span>
    <span id="eye-toggle" title="ุฅุฎูุงุก/ุฅุธูุงุฑ ุงูุจุญุซ">๐๏ธ</span>
    <div class="hover-toggle-container">
      <span>Hover</span>
      <label class="switch">
        <input type="checkbox" id="js-toggle" checked>
        <span class="slider round"></span>
      </label>
    </div>
  </div>
</div>

<div id="eye-toggle-standalone" class="top">๐๏ธ</div>

<!-- ุดุงุดุฉ ุงูุชุญููู -->
<div id="loading-overlay">
  <div id="loading-content">
    <img id="splash-image" src="image/0.png" alt="ุดุนุงุฑ ุงูุชุญููู" />
    <h1 id="project-loading-title">ุฌุงุฑู ุงูุชุญููู...</h1>
    <div id="loader-lights">
      <div class="light-bulb" id="bulb-1"></div>
      <div class="light-bulb" id="bulb-2"></div>
      <div class="light-bulb" id="bulb-3"></div>
      <div class="light-bulb" id="bulb-4"></div>
    </div>
    <div id="legend">
      <div class="legend-item red">ุฃุณุฆูุฉ</div>
      <div class="legend-item yellow">ูุญุงุถุฑุงุช</div>
      <div class="legend-item white">ููุงุฏ ุฃุฎุฑู</div>
      <div class="legend-item purple">ุฅุฌุงุจุงุช</div>
      <div class="legend-item green">ุณูุงุดู ุงูุนููู</div>
      <div class="legend-item blue">ููุฏูู ุดุฑุญ</div>
    </div>
  </div>
</div>

<!-- ุนุงุฑุถ PDF -->
<div id="pdf-overlay" class="hidden">
  <div id="toolbar">
    <div id="pdf-controls">
      <button id="closePdfBtn" class="toolbar-btn">โ ุฅุบูุงู</button>
      <button id="downloadBtn" class="toolbar-btn">โฌ ุชุญููู</button>
      <button id="shareBtn" class="toolbar-btn">๐ ูุดุงุฑูุฉ</button>
    </div>
  </div>
  <iframe id="pdfFrame" src="" sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
</div>

<!-- ูุงูุฐุฉ ูุนุงููุฉ PDF -->
<div id="pdf-preview-popup" class="floating-preview">
  <div class="preview-container">
    <div class="preview-header">
      <div class="preview-title" id="preview-filename">ูุนุงููุฉ ุงูููู</div>
      <button class="preview-btn preview-open-btn" id="preview-open-btn">๐ ูุชุญ</button>
    </div>
    <div class="preview-canvas-container">
      <div class="preview-loading" id="preview-loading">โณ ุฌุงุฑู ุงูุชุญููู...</div>
      <canvas id="preview-canvas"></canvas>
    </div>
  </div>
</div>

<!-- ุงูุฎุฑูุทุฉ ุงูุชูุงุนููุฉ -->
<div id="scroll-container">
  <svg id="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMinYMin meet">
    <defs></defs>
    <g transform="translate(0,0)" id="files-list-container">
      <image data-src="image/wood.webp" x="0" y="0" width="1024" height="2454" style="pointer-events: none;" />
    </g>
    <g id="dynamic-links-group"></g>
    <g id="group-specific-content"></g>
    <g id="upper-wood-layer" style="pointer-events: none; z-index: 3;">
      <image data-src="image/Upper_wood.webp" x="0" y="0" width="1024" height="250" style="pointer-events: none;" />
    </g>
    <g id="fixed-controls-layer">
      <g id="change-group-btn" style="cursor: pointer;">
        <rect x="120" y="100" width="250" height="50" rx="10"/>
        <text id="group-btn-text" x="245" y="130" text-anchor="middle" dominant-baseline="middle">Change Group ๐</text>
      </g>
      <g id="preload-btn" style="cursor: pointer;">
        <rect x="387" y="100" width="250" height="50" rx="10"/>
        <text x="512" y="130" text-anchor="middle" dominant-baseline="middle">๐ ุดุงุดุฉ ุงูุชุญููู</text>
      </g>
      <g id="reset-btn" style="cursor: pointer;">
        <rect x="654" y="100" width="250" height="50" rx="10"/>
        <text id="reset-btn-text" x="779" y="130" text-anchor="middle" dominant-baseline="middle">๐ test </text>
      </g>
      <g id="back-button-group" style="cursor: pointer;">
        <rect id="back-btn" x="112" y="160" width="800" height="70" rx="15" />
        <text x="512" y="195" id="back-btn-text" text-anchor="middle" dominant-baseline="middle">โก๏ธ ุฅูู ุงูุฎุฑูุทุฉ โก๏ธ</text>
      </g>
    </g>
  </svg>
</div>

<!-- ======================== ููุงูุฉ ุนูุงุตุฑ ุงููุงุฌูุฉ ======================== -->

<!-- ================ ุงูููุชุจุงุช ุงูุฎุงุฑุฌูุฉ ================ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
  if (typeof pdfjsLib !== 'undefined') {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  }
</script>

<!-- โ ุงูุณูุฑูุจุช ุงูุฑุฆูุณู โ ููุทุฉ ุงูุฏุฎูู ุงููุญูุฏุฉ -->
<script type="module" src="script.js"></script>

<!-- โ Service Worker -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js')
      .then(registration => {
        console.log('โ Service Worker ูุณุฌู');
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
              if (confirm('๐ ููุฌุฏ ุชุญุฏูุซ ุฌุฏูุฏ. ูู ุชุฑูุฏ ุฅุนุงุฏุฉ ุงูุชุญูููุ')) {
                newWorker.postMessage({ action: 'skipWaiting' });
                window.location.reload();
              }
            }
          });
        });
      })
      .catch(err => console.error('โ ูุดู ุชุณุฌูู SW:', err));
  });

  let refreshing = false;
  navigator.serviceWorker.addEventListener('controllerchange', () => {
    if (!refreshing) {
      refreshing = true;
      window.location.reload();
    }
  });
}
</script>

<!-- โ ูุญุต ุงูุชุญุฏูุซุงุช ูู GitHub -->
<script>
async function checkForUpdates() {
  try {
    const lastCheck = localStorage.getItem('last_update_check');
    const now = Date.now();
    if (lastCheck && (now - parseInt(lastCheck)) < 300000) return;

    const response = await fetch(
      'https://api.github.com/repos/MUE24Med/s3/commits/main',
      { cache: 'no-store', headers: { 'Accept': 'application/vnd.github.v3+json' } }
    );
    if (!response.ok) return;
    const data = await response.json();
    const latestSha = data.sha.substring(0, 7);
    const lastSha = localStorage.getItem('last_commit_sha');

    if (!lastSha) {
      localStorage.setItem('last_commit_sha', latestSha);
      localStorage.setItem('last_update_check', now.toString());
      return;
    }

    if (lastSha !== latestSha) {
      console.log('๐ ุชุญุฏูุซ ุฌุฏูุฏ ูุชุงุญ:', latestSha);
      const cacheNames = await caches.keys();
      await Promise.all(cacheNames.map(name => caches.delete(name)));
      localStorage.setItem('last_commit_sha', latestSha);
      localStorage.removeItem('preload_done');
      window.location.reload(true);
    } else {
      localStorage.setItem('last_update_check', now.toString());
    }
  } catch (error) {
    console.warn('โ๏ธ ุฎุทุฃ ูู ูุญุต ุงูุชุญุฏูุซุงุช:', error);
  }
}
window.addEventListener('load', checkForUpdates);
document.addEventListener('visibilitychange', () => {
  if (!document.hidden) checkForUpdates();
});
</script>
</body>
</html>
