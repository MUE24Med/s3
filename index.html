<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <!-- Ø£Ø³Ø§Ø³ÙŠØ§Øª -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>semester-3 | Ø®Ø±ÙŠØ·Ø© Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</title>

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://mue24med.github.io/semester-3/">
  <meta property="og:title" content="semester-3 | Ø®Ø±ÙŠØ·Ø© Ø§Ù„ÙƒÙ„ÙŠØ© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©">
  <meta property="og:description" content="Ø®Ø±ÙŠØ·Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ø¹Ø±Ø¶ Ù…Ø­Ø§Ø¶Ø±Ø§Øª ÙˆØ³ÙƒØ§Ø´Ù† Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©">
  <meta property="og:image" content="https://mue24med.github.io/semester-3/image/0.webp">
  <meta property="og:locale" content="ar_AR">

  <!-- PWA / Mobile -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000000">

  <!-- Cache Control -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta name="version" content="2025.02.11.MODULE.v1">

  <!-- Icons -->
  <link rel="icon" type="image/png" href="image/0.png">
  <link rel="apple-touch-icon" href="image/0.png">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- âœ… Ø¬Ù…ÙŠØ¹ HTML ÙƒÙ…Ø§ Ù‡Ùˆ - Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ± -->
<!-- [Ù†ÙØ³ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù…Ù† index.html Ø§Ù„Ø­Ø§Ù„ÙŠ] -->

<!-- Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
  if (typeof pdfjsLib !== 'undefined') {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
  }
</script>

<!-- âœ… Ø§Ù„Ø³ÙƒØ±ÙŠØ¨ØªØ§Øª Ø§Ù„Ù…Ù‚Ø³Ù…Ø© - Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ­ÙŠØ­ -->
<script type="module" src="javascript/core/config.js"></script>
<script type="module" src="javascript/core/utils.js"></script>
<script type="module" src="javascript/core/navigation.js"></script>
<script type="module" src="javascript/core/group-loader.js"></script>
<script type="module" src="javascript/ui/pdf-viewer.js"></script>
<script type="module" src="javascript/ui/wood-interface.js"></script>
<script type="module" src="javascript/features/svg-processor.js"></script>
<script type="module" src="javascript/features/preload-game.js"></script>
<script type="module" src="javascript/script.js"></script>

<!-- âœ… Tracker Ù…Ù†ÙØµÙ„ -->
<script src="tracker.js"></script>

<!-- âœ… Service Worker -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js')
      .then(registration => {
        console.log('âœ… Service Worker Ù…Ø³Ø¬Ù„');
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;
          newWorker.addEventListener('statechange', () => {
            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
              if (confirm('ğŸ”„ ÙŠÙˆØ¬Ø¯ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙŠØ¯. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŸ')) {
                newWorker.postMessage({ action: 'skipWaiting' });
                window.location.reload();
              }
            }
          });
        });
      })
      .catch(err => console.error('âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ SW:', err));
  });

  let refreshing = false;
  navigator.serviceWorker.addEventListener('controllerchange', () => {
    if (!refreshing) {
      refreshing = true;
      window.location.reload();
    }
  });
}
</script>

<!-- âœ… ÙØ­Øµ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª -->
<script>
async function checkForUpdates() {
  try {
    const lastCheck = localStorage.getItem('last_update_check');
    const now = Date.now();
    if (lastCheck && (now - parseInt(lastCheck)) < 300000) return;

    const response = await fetch(
      'https://api.github.com/repos/MUE24Med/s3/commits/main',
      { cache: 'no-store', headers: { 'Accept': 'application/vnd.github.v3+json' } }
    );

    if (!response.ok) return;

    const data = await response.json();
    const latestSha = data.sha.substring(0, 7);
    const lastSha = localStorage.getItem('last_commit_sha');

    if (!lastSha) {
      localStorage.setItem('last_commit_sha', latestSha);
      localStorage.setItem('last_update_check', now.toString());
      return;
    }

    if (lastSha !== latestSha) {
      const cacheNames = await caches.keys();
      await Promise.all(cacheNames.map(name => caches.delete(name)));
      localStorage.setItem('last_commit_sha', latestSha);
      localStorage.removeItem('preload_done');
      window.location.reload(true);
    } else {
      localStorage.setItem('last_update_check', now.toString());
    }
  } catch (error) {
    console.error('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙØ­Øµ:', error);
  }
}

window.addEventListener('load', checkForUpdates);
document.addEventListener('visibilitychange', () => {
  if (!document.hidden) checkForUpdates();
});
</script>
</body>
</html>